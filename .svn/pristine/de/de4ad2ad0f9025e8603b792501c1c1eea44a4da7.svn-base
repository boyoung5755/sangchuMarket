<?xml version="1.0" encoding="UTF-8"?>
<!-- 이 문서는 myBatis에서 처리할 SQL문을 작성하는 문서입니다. -->
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	최초 작성자 : 김석호
	최초 작성일 : 2023.08.10 10:25
	
	최근 수정자 : 김석호
	최근 수정일 : 2023.08.11 11:05
	
	수정내역
	2023.08.11 10:33 - 김석호 : 본인 거래글 정보 들고오는 쿼리문 추가
	2023.08.11 11:05 - 김석호 : 닉네임 변경용 쿼리문 추가
 -->
<mapper namespace="mypage">
	<!-- 유저의 이메일로 찜목록, 해당 거래글의 구분코드, 제목을 가지고 오는 쿼리문 -->
	<select id="getAllJjimList" parameterType="String" resultType="jjimVO">
		select j.t_no, j.email, tb.tb_title, t.t_state from t_jjim j, trade t, t_board tb where t.t_no = j.t_no and tb.t_no = j.t_no and j.email = #{email}
	</select>
	
	<!-- 거래번호로 이미지 테이블에서 대표이미지파일명을 하나 들고오는 쿼리문 -->
	<select id="getOneImgSrc" parameterType ="String" resultType="String">
		select img_src from images where img_code = #{t_no} and 1 >= rownum
	</select>
	<!-- 이메일로 본인이 등록한 거래글의 간략한 정보를 가지고 오는 쿼리문 -->
	<select id="getmyRegList" parameterType="String" resultType="regTradeVO">
		select t.t_no, tb.tb_title, t.t_state, t.t_type 
		from trade t, t_board tb
		where t.t_no = tb.t_no
		and t.email = #{email}
	</select>
	<!-- 변경하고자 하는 닉네임으로 레코드수를 받아오는 메소드 -->
	<select id="checkNickname" resultType="Integer" parameterType="String">
		select
			count(*)
		from
			users
		where u_nick = #{targetNickname}
	</select>
	<!-- 변경하고자 하는 닉네임으로 변경하는 메소드 -->
	<update id="updateNickName" parameterType="memVO">
		update users
		set
			u_nick = #{u_nick}
		where
			email = #{email}
	</update>
</mapper>