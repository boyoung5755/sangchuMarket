<?xml version="1.0" encoding="UTF-8"?>
<!-- 이 문서는 myBatis에서 처리할 SQL문을 작성하는 문서입니다. -->
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<!-- 
	최초 작성자 : 박민주
	최초 작성일 : 2023.08.08 00:05 ....
	
	미완성
 -->	
<mapper namespace="member">

	<!--[1차 회원가입] 이메일 중복검사 -->
	<select id="checkEmail" parameterType="String" resultType="String">
		select email userEmail from all_users where email=#{email} 
	</select>
	
	<!--[1차 회원가입] 1차 회원가입 정보 입력 -->
	<insert id="insertFristSignup" parameterType="memVO">
		insert into all_users (email, pass, name, logindate, a_code) 
		values (#{email}, #{pass}, #{name}, sysdate, '0')
	</insert>
	
	<!--[2차 회원가입] a_code확인 -->
	<select id="checkACode" parameterType="String" resultType="String">
		select A_code from all_users where email=#{email}
	</select>

	<!--[2차 회원가입] 닉네임 중복검사-->
	<select id="checkNickname" parameterType="String" resultType="String">
		select U_nick from users where U_nick=#{nick}
	</select>
	
	<!--[로그인] 아이디&비밀번호가 존재하는지-->
	<select id="login" parameterType="memVO" resultType="int">
		select count(*) from all_users where email=#{email} and pass=#{pass}
	</select>
	
	<!-- [로그인] ull_users, users 테이블에서 튜플 한줄 선택 -->
	<select id="getAllMemberInfo" parameterType="String" resultType="memVO">
		select all_users.*, users.*
				from all_users
				inner join users on all_users.email = users.email
		where all_users.email = #{email}
	</select>
	
	<!-- [로그인] (실패) 시도 횟수 count+1  -->
	<update id="updateLoginTry" parameterType="String">
		update users set U_TRY= (U_TRY+1) where email=#{email}
	</update>
	
	<!-- [로그인] (성공) 시도 횟수 0으로, 탈퇴일 null로  -->
	<update id="updateTryToZero" parameterType="String">
		update users set U_TRY= 0, U_WITHDRAWDATE=null  where email=#{email}
	</update>
	
	
</mapper>